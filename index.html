<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWICE Concert Vote - Grand Finale</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --twice-pink: #ff4081; --twice-apricot: #f68a5c; --dark: #121212; }
        body { font-family: 'Kanit', sans-serif; background-color: var(--dark); color: white; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 600px; margin: auto; }
        .member-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .member-card { background: #222; border-radius: 12px; padding: 10px; cursor: pointer; border: 2px solid transparent; }
        .member-card img { width: 100%; aspect-ratio: 1; border-radius: 10px; object-fit: cover; }
        .member-card.selected { border-color: var(--twice-pink); transform: scale(1.05); }

        /* Winner Overlay */
        #winnerOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; }
        .winner-content { animation: winnerZoom 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes winnerZoom { from { transform: scale(0); } to { transform: scale(1); } }
        .winner-title { font-size: 40px; color: gold; text-shadow: 0 0 20px gold; margin-bottom: 20px; }
        .winner-photos { display: flex; gap: 20px; margin-bottom: 20px; }
        .winner-img { width: 140px; height: 140px; border-radius: 50%; border: 5px solid gold; box-shadow: 0 0 30px rgba(255,215,0,0.5); }
        
        .result-item { background: #1e1e1e; border-radius: 15px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; border-left: 5px solid var(--twice-pink); }
        .res-img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--twice-pink); margin-right: -10px; }
        .vote-count-badge { background: var(--twice-pink); padding: 5px 12px; border-radius: 15px; margin-left: auto; font-weight: bold; }
        #closedBanner { display: none; background: #ff4444; padding: 15px; border-radius: 15px; margin-bottom: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div id="winnerOverlay">
    <div class="winner-content">
        <div class="winner-title">üëë WINNER üëë</div>
        <div class="winner-photos">
            <img id="winnerImg1" class="winner-img">
            <img id="winnerImg2" class="winner-img">
        </div>
        <h1 id="winnerName" style="font-size: 50px; margin: 0; color: var(--twice-pink);"></h1>
        <p id="winnerVotes" style="font-size: 24px; color: #fff;"></p>
        <button onclick="location.reload()" style="margin-top:30px; padding:10px 20px; border-radius:20px; background:white; color:black; border:none; cursor:pointer;">‡∏î‡∏π‡∏ú‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
</div>

<div class="container">
    <h1 style="color: var(--twice-pink);">üç≠ TWICE Ship Vote</h1>
    <div id="closedBanner">üõë ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß!</div>
    
    <div id="votingArea">
        <div id="memberGrid" class="member-grid"></div>
    </div>

    <div id="dashboard">
        <h2 style="text-align: left; border-bottom: 1px solid #333; padding-bottom: 10px;">üìä Real-time Ranking</h2>
        <div id="voteResults">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô...</div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBNekaRne5Df7fAT5AYPHj0JAxU0CTJniE",
        authDomain: "twicevote-1afb1.firebaseapp.com",
        databaseURL: "https://twicevote-1afb1-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "twicevote-1afb1",
        storageBucket: "twicevote-1afb1.firebasestorage.app",
        messagingSenderId: "425724964279",
        appId: "1:425724964279:web:86dfb7f093772e91fa4c32"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const memberPhotos = {
        "Nayeon": "https://i.pinimg.com/736x/6d/67/15/6d6715b00cf184b780b53684cd7bf9fa.jpg",
        "Jeongyeon": "https://i.pinimg.com/736x/0d/c3/36/0dc33624e51b1f2210b0888b66edaea2.jpg",
        "Momo": "https://i.pinimg.com/736x/2d/96/bb/2d96bb2864427542942e5db59eceedbd.jpg",
        "Sana": "https://i.pinimg.com/736x/f3/77/90/f37790a6d2c0b4e70695b2ada1c61d6d.jpg",
        "Jihyo": "https://i.pinimg.com/736x/f4/08/7c/f4087cd2f2022785a84e8b60405431d9.jpg",
        "Mina": "https://i.pinimg.com/736x/2b/2c/dc/2b2cdce500937e1560b820602e811fdd.jpg",
        "Dahyun": "https://i.pinimg.com/736x/66/2b/d9/662bd98ca61e4ec719047109d301ea80.jpg",
        "Chaeyoung": "https://i.pinimg.com/736x/89/28/c3/8928c35a2fc34b9a0927ab63c6304727.jpg",
        "Tzuyu": "https://i.pinimg.com/736x/27/dc/16/27dc169eefd7ae58818beb366374dfed.jpg"
    };

    const shipNames = {
        "Jeongyeon-Nayeon": "2yeon", "Momo-Nayeon": "NaMo", "Nayeon-Sana": "Sanayeon", "Jihyo-Nayeon": "NaHyo", "Mina-Nayeon": "Minayeon", "Dahyun-Nayeon": "YeonDub", "Chaeyoung-Nayeon": "NaChaeng", "Nayeon-Tzuyu": "NaTzu",
        "Jeongyeon-Momo": "JeongMo", "Jeongyeon-Sana": "230s", "Jeongyeon-Jihyo": "JeongHyo", "Jeongyeon-Mina": "JeongMi", "Dahyun-Jeongyeon": "DaJeong", "Chaeyoung-Jeongyeon": "NoJams", "Jeongyeon-Tzuyu": "JeongTzu",
        "Momo-Sana": "MoSa", "Jihyo-Momo": "MoJi", "Mina-Momo": "Mimo", "Dahyun-Momo": "Dahmo", "Chaeyoung-Momo": "MoChaeng", "Momo-Tzuyu": "Tzumo",
        "Jihyo-Sana": "SaHyo", "Mina-Sana": "SaMi", "Dahyun-Sana": "SaiDa", "Chaeyoung-Sana": "SaChaeng", "Sana-Tzuyu": "Satzu",
        "Jihyo-Mina": "MiHyo", "Dahyun-Jihyo": "DaHyo", "Chaeyoung-Jihyo": "JiChaeng", "Jihyo-Tzuyu": "Jitzu",
        "Dahyun-Mina": "DahMi", "Chaeyoung-Mina": "MiChaeng", "Mina-Tzuyu": "Mitzu",
        "Chaeyoung-Dahyun": "DubChaeng", "Dahyun-Tzuyu": "DaTzu", "Chaeyoung-Tzuyu": "ChaeTzu"
    };

    let selected = [];
    let isClosed = false;

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï: ‡∏ü‡∏±‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Firebase ‡∏ó‡∏µ‡πà 'voting_status'
    db.ref('voting_status').on('value', (snap) => {
        if (snap.val() === 'closed') {
            isClosed = true;
            document.getElementById('votingArea').style.display = 'none';
            document.getElementById('closedBanner').style.display = 'block';
            showWinnerOverlay();
        }
    });

    function showWinnerOverlay() {
        db.ref('votes').once('value', (snap) => {
            const data = snap.val() || {};
            const sorted = Object.entries(data).sort((a,b) => b[1]-a[1]);
            if (sorted.length > 0) {
                const winnerKey = sorted[0][0];
                const winnerCount = sorted[0][1];
                const [m1, m2] = winnerKey.split("-");
                document.getElementById('winnerImg1').src = memberPhotos[m1];
                document.getElementById('winnerImg2').src = memberPhotos[m2];
                document.getElementById('winnerName').innerText = shipNames[winnerKey] || winnerKey;
                document.getElementById('winnerVotes').innerText = winnerCount + " ‡πÇ‡∏´‡∏ß‡∏ï";
                document.getElementById('winnerOverlay').style.display = 'flex';
            }
        });
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Grid ‡πÄ‡∏°‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    const grid = document.getElementById('memberGrid');
    Object.keys(memberPhotos).forEach(name => {
        const div = document.createElement('div');
        div.className = 'member-card';
        div.innerHTML = `<img src="${memberPhotos[name]}"><div>${name}</div>`;
        div.onclick = () => {
            if (isClosed) return;
            // ... Logic ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2 ‡∏Ñ‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÇ‡∏´‡∏ß‡∏ï (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
            if (selected.includes(name)) {
                selected = selected.filter(x => x !== name);
                div.classList.remove('selected');
            } else if (selected.length < 2) {
                selected.push(name);
                div.classList.add('selected');
                if (selected.length === 2) {
                    const key = [...selected].sort().join("-");
                    db.ref('votes/' + key).transaction(c => (c || 0) + 1);
                    selected = [];
                    document.querySelectorAll('.member-card').forEach(c => c.classList.remove('selected'));
                    alert("‡πÇ‡∏´‡∏ß‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
                }
            }
        };
        grid.appendChild(div);
    });

    function listenToVotes() {
        db.ref('votes').on('value', (snap) => {
            const data = snap.val() || {};
            const res = document.getElementById('voteResults');
            res.innerHTML = "";
            Object.entries(data).sort((a,b) => b[1]-a[1]).forEach(([key, count]) => {
                const [m1, m2] = key.split("-");
                res.innerHTML += `
                    <div class="result-item">
                        <img src="${memberPhotos[m1]}" class="res-img"><img src="${memberPhotos[m2]}" class="res-img">
                        <div style="margin-left:25px; text-align:left;">
                            <b>${shipNames[key] || key}</b>
                        </div>
                        <div class="vote-count-badge">${count}</div>
                    </div>`;
            });
        });
    }
    listenToVotes();
</script>
</body>
</html>
