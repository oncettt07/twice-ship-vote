<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TWICE Ship Vote - Ultimate Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { --twice-pink: #ff4081; --twice-apricot: #f68a5c; --dark: #121212; }
        body { font-family: 'Kanit', sans-serif; background-color: var(--dark); color: white; margin: 0; padding: 20px; text-align: center; overflow-x: hidden; }
        .container { max-width: 600px; margin: auto; padding-bottom: 100px; }
        
        .member-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 20px 0; }
        .member-card { background: #222; border-radius: 15px; padding: 10px; cursor: pointer; border: 3px solid transparent; transition: 0.3s; }
        .member-card.selected { border-color: var(--twice-pink); transform: scale(1.05); box-shadow: 0 0 15px var(--twice-pink); }
        .member-card img { width: 100%; aspect-ratio: 1; border-radius: 12px; object-fit: cover; }

        /* Floating Confirm Button */
        #floatingConfirm {
            display: none; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(45deg, var(--twice-pink), var(--twice-apricot));
            color: white; padding: 15px 40px; border-radius: 50px; font-size: 20px; font-weight: bold;
            box-shadow: 0 10px 30px rgba(255, 64, 129, 0.5); border: none; cursor: pointer;
            z-index: 1000; animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes slideUp { from { bottom: -100px; opacity: 0; } to { bottom: 30px; opacity: 1; } }

        /* Success & Particles */
        .candy-bong { position: fixed; font-size: 35px; pointer-events: none; z-index: 5000; }
        .confetti { position: fixed; width: 10px; height: 10px; z-index: 4500; pointer-events: none; border-radius: 2px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 4000; }
        .modal-content { background: #fff; color: #333; padding: 25px; border-radius: 25px; width: 85%; max-width: 350px; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡πÇ‡∏´‡∏ß‡∏ï‡∏û‡∏£‡πâ‡∏≠‡∏° Action Feedback */
        .btn-final { 
            background: var(--twice-pink); color: white; border: none; padding: 15px; border-radius: 30px; 
            font-size: 20px; width: 100%; font-weight: bold; cursor: pointer; transition: 0.2s; 
        }
        .btn-final:active { transform: scale(0.92); filter: brightness(0.9); } /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡∏à‡∏¥‡πâ‡∏° */
        .btn-loading { background: #bbb !important; pointer-events: none; }

        .result-item { background: #1e1e1e; border-radius: 20px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; border-left: 6px solid var(--twice-pink); }
        .res-img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--twice-pink); margin-right: -15px; }
        .vote-count-badge { background: var(--twice-pink); padding: 5px 15px; border-radius: 15px; font-weight: bold; margin-left: auto; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="color: var(--twice-pink);">üç≠ TWICE Ship Vote</h1>
    <p id="instruction" style="color: #888;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå 2 ‡∏Ñ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏ß‡∏ï</p>
    
    <div id="memberGrid" class="member-grid"></div>

    <div id="dashboard">
        <h2 style="text-align: left; border-bottom: 1px solid #333; padding-bottom: 10px;">üèÜ LIVE RANKING</h2>
        <div id="voteResults">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...</div>
    </div>
</div>

<button id="floatingConfirm" onclick="openConfirmModal()">üíñ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏π‡πà‡∏ä‡∏¥‡∏õ‡∏ô‡∏µ‡πâ!</button>

<div id="voteModal" class="modal">
    <div class="modal-content">
        <h2 id="shipNameDisplay" style="margin:0; color: var(--twice-pink); font-size: 32px;"></h2>
        <div style="display:flex; justify-content:center; align-items:center; gap:10px; margin:20px 0;">
            <img id="prev1" style="width:80px; height:80px; border-radius:50%; border:3px solid var(--twice-pink); object-fit:cover;">
            <span>‚ù§Ô∏è</span>
            <img id="prev2" style="width:80px; height:80px; border-radius:50%; border:3px solid var(--twice-pink); object-fit:cover;">
        </div>
        <button class="btn-final" id="finalBtn" onclick="submitVoteWithFullEffects()">‡∏™‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÇ‡∏´‡∏ß‡∏ï! üç≠</button>
        <button id="cancelBtn" style="background:none; border:none; color:#888; margin-top:15px; cursor:pointer;" onclick="closeModal()">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà..‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBNekaRne5Df7fAT5AYPHj0JAxU0CTJniE",
        authDomain: "twicevote-1afb1.firebaseapp.com",
        databaseURL: "https://twicevote-1afb1-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "twicevote-1afb1",
        storageBucket: "twicevote-1afb1.firebasestorage.app",
        messagingSenderId: "425724964279",
        appId: "1:425724964279:web:86dfb7f093772e91fa4c32"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const memberPhotos = {
        "Nayeon": "https://i.pinimg.com/736x/6d/67/15/6d6715b00cf184b780b53684cd7bf9fa.jpg",
        "Jeongyeon": "https://i.pinimg.com/736x/0d/c3/36/0dc33624e51b1f2210b0888b66edaea2.jpg",
        "Momo": "https://i.pinimg.com/736x/2d/96/bb/2d96bb2864427542942e5db59eceedbd.jpg",
        "Sana": "https://i.pinimg.com/736x/f3/77/90/f37790a6d2c0b4e70695b2ada1c61d6d.jpg",
        "Jihyo": "https://i.pinimg.com/736x/f4/08/7c/f4087cd2f2022785a84e8b60405431d9.jpg",
        "Mina": "https://i.pinimg.com/736x/2b/2c/dc/2b2cdce500937e1560b820602e811fdd.jpg",
        "Dahyun": "https://i.pinimg.com/736x/66/2b/d9/662bd98ca61e4ec719047109d301ea80.jpg",
        "Chaeyoung": "https://i.pinimg.com/736x/89/28/c3/8928c35a2fc34b9a0927ab63c6304727.jpg",
        "Tzuyu": "https://i.pinimg.com/736x/27/dc/16/27dc169eefd7ae58818beb366374dfed.jpg"
    };

    const shipNames = {
        "Jeongyeon-Nayeon": "2yeon", "Momo-Nayeon": "NaMo", "Nayeon-Sana": "Sanayeon", "Jihyo-Nayeon": "NaHyo", "Mina-Nayeon": "Minayeon", "Dahyun-Nayeon": "YeonDub", "Chaeyoung-Nayeon": "NaChaeng", "Nayeon-Tzuyu": "NaTzu",
        "Jeongyeon-Momo": "JeongMo", "Jeongyeon-Sana": "230s", "Jeongyeon-Jihyo": "JeongHyo", "Jeongyeon-Mina": "JeongMi", "Dahyun-Jeongyeon": "DaJeong", "Chaeyoung-Jeongyeon": "NoJams", "Jeongyeon-Tzuyu": "JeongTzu",
        "Momo-Sana": "MoSa", "Jihyo-Momo": "MoJi", "Mina-Momo": "Mimo", "Dahyun-Momo": "Dahmo", "Chaeyoung-Momo": "MoChaeng", "Momo-Tzuyu": "Tzumo",
        "Jihyo-Sana": "SaHyo", "Mina-Sana": "SaMi", "Dahyun-Sana": "SaiDa", "Chaeyoung-Sana": "SaChaeng", "Sana-Tzuyu": "Satzu",
        "Jihyo-Mina": "MiHyo", "Dahyun-Jihyo": "DaHyo", "Chaeyoung-Jihyo": "JiChaeng", "Jihyo-Tzuyu": "Jitzu",
        "Dahyun-Mina": "DahMi", "Chaeyoung-Mina": "MiChaeng", "Mina-Tzuyu": "Mitzu",
        "Chaeyoung-Dahyun": "DubChaeng", "Dahyun-Tzuyu": "DaTzu", "Chaeyoung-Tzuyu": "ChaeTzu"
    };

    let selected = [];

    function init() {
        const grid = document.getElementById('memberGrid');
        Object.keys(memberPhotos).forEach(name => {
            const div = document.createElement('div');
            div.className = 'member-card';
            div.innerHTML = `<img src="${memberPhotos[name]}"><div>${name}</div>`;
            div.onclick = () => selectMember(name, div);
            grid.appendChild(div);
        });
        listenVotes();
    }

    function selectMember(name, el) {
        if (selected.includes(name)) {
            selected = selected.filter(x => x !== name);
            el.classList.remove('selected');
        } else if (selected.length < 2) {
            selected.push(name);
            el.classList.add('selected');
        }
        document.getElementById('floatingConfirm').style.display = (selected.length === 2) ? 'block' : 'none';
        document.getElementById('instruction').innerText = (selected.length === 1) ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏µ‡∏Å 1 ‡∏Ñ‡∏ô' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå 2 ‡∏Ñ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏ß‡∏ï';
    }

    function openConfirmModal() {
        const key = [...selected].sort().join("-");
        document.getElementById('shipNameDisplay').innerText = shipNames[key] || selected.join(" x ");
        document.getElementById('prev1').src = memberPhotos[selected[0]];
        document.getElementById('prev2').src = memberPhotos[selected[1]];
        document.getElementById('voteModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('voteModal').style.display = 'none';
        selected = [];
        document.querySelectorAll('.member-card').forEach(c => c.classList.remove('selected'));
        document.getElementById('floatingConfirm').style.display = 'none';
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡πÇ‡∏´‡∏ß‡∏ï‡∏û‡∏£‡πâ‡∏≠‡∏° Action Feedback
    function submitVoteWithFullEffects() {
        const btn = document.getElementById('finalBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const btnRect = btn.getBoundingClientRect();
        
        // 1. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        btn.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡πÇ‡∏´‡∏ß‡∏ï... üç≠";
        btn.classList.add('btn-loading');
        cancelBtn.style.visibility = 'hidden'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏±‡∏ô‡∏û‡∏•‡∏≤‡∏î
        
        // 2. Candy Bong ‡∏û‡∏∏‡πà‡∏á‡∏Å‡∏£‡∏∞‡∏à‡∏∏‡∏¢ üç≠
        for(let i=0; i<25; i++) spawnCandy(btnRect.left + btnRect.width/2, btnRect.top + btnRect.height/2);
        
        // 3. Confetti ‡πÇ‡∏õ‡∏£‡∏¢‡∏â‡∏•‡∏≠‡∏á üéâ
        spawnConfetti();

        // 4. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡∏á Firebase
        const key = [...selected].sort().join("-");
        db.ref('votes/' + key).transaction(c => (c || 0) + 1, (error, committed) => {
            if (committed || !error) {
                setTimeout(() => {
                    document.getElementById('voteModal').style.display = 'none';
                    closeModal();
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏™‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏°
                    btn.innerHTML = "‡∏™‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÇ‡∏´‡∏ß‡∏ï! üç≠";
                    btn.classList.remove('btn-loading');
                    cancelBtn.style.visibility = 'visible';
                }, 1200);
            }
        });
    }

    function spawnCandy(x, y) {
        const p = document.createElement('div');
        p.className = 'candy-bong'; p.innerText = 'üç≠';
        document.body.appendChild(p);
        const dX = (Math.random()-0.5) * 600;
        const dY = (Math.random()-0.5) * 600;
        p.animate([{transform:`translate(${x}px,${y}px) scale(1.2)`, opacity:1}, 
                   {transform:`translate(${x+dX}px,${y+dY}px) scale(0) rotate(1080deg)`, opacity:0}], 1500).onfinish = () => p.remove();
    }

    function spawnConfetti() {
        for(let i=0; i<60; i++) {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.style.left = Math.random()*100 + 'vw';
            c.style.backgroundColor = ['#ff4081','#f68a5c','#ffd700','#ffffff'][Math.floor(Math.random()*4)];
            document.body.appendChild(c);
            c.animate([{top:'-10vh', transform:'rotate(0deg)'}, {top:'110vh', transform:'rotate(1000deg)'}], 
                      {duration: Math.random()*2500+2000, easing:'ease-out'}).onfinish = () => c.remove();
        }
    }

    function listenVotes() {
        db.ref('votes').on('value', snap => {
            const data = snap.val() || {};
            const res = document.getElementById('voteResults');
            res.innerHTML = "";
            Object.entries(data).sort((a,b) => b[1]-a[1]).forEach(([key, count]) => {
                const [m1, m2] = key.split("-");
                res.innerHTML += `
                    <div class="result-item">
                        <img src="${memberPhotos[m1]}" class="res-img"><img src="${memberPhotos[m2]}" class="res-img">
                        <div style="margin-left:25px; text-align:left;">
                            <b style="color:white; font-size:18px;">${shipNames[key] || key}</b><br>
                            <small style="color:#aaa;">${m1} & ${m2}</small>
                        </div>
                        <div class="vote-count-badge">${count}</div>
                    </div>`;
            });
        });
    }

    init();
</script>
</body>
</html>
